#include "../BIT_MATH.h"
#include "../Interface/DIO_Interface.h"
#include "../Interface/LCD_Interface.h"
#include "../Register/DIO_Register.h"
#include "../STD_types.h"
#define F_CPU 8000000
#include "avr/delay.h"

void LCD_Init()
{
	_delay_ms(30);
	DIO_SetPortDir(lcd_DataPORT,OUTPUT_PORT);
	DIO_SetPinDir(lcd_ControlPORT,lcd_RSPIN,OUTPUT_PIN);
	DIO_SetPinDir(lcd_ControlPORT,lcd_RWPIN,OUTPUT_PIN);
	DIO_SetPinDir(lcd_ControlPORT,lcd_EPIN,OUTPUT_PIN);
	_delay_ms(30);

	LCD_Write_Command(lcd_Home); _delay_ms(15);
	LCD_Write_Command(lcd_FunctionSet8bit_5x10Dots); _delay_ms(1);
	LCD_Write_Command(lcd_DisplayOn); _delay_ms(1);
	LCD_Write_Command(lcd_Clear); _delay_ms(15);
	LCD_Write_Command(lcd_EntryMode); _delay_ms(2);
}

void LCD_Write_Command(u8 u8_Command_Copy)
{
	DIO_SetPinValue(lcd_ControlPORT,lcd_RSPIN,LOW); // rs = 0 (command -> 0 char -> 1)
	DIO_SetPinValue(lcd_ControlPORT,lcd_RWPIN,LOW); //rw=0
	DIO_SetPinValue(lcd_ControlPORT,lcd_EPIN,HIGH_PIN);// e=1
	DIO_SetPortValue(lcd_DataPORT,u8_Command_Copy);
	DIO_SetPinValue(lcd_ControlPORT,lcd_EPIN,LOW);// e=0
	_delay_us(5);
	DIO_SetPinValue(lcd_ControlPORT, lcd_EPIN, HIGH_PIN);
	_delay_us(10);
}

void LCD_Write_Char(u8 u8_Data_Copy)
{
	DIO_SetPinValue(lcd_ControlPORT,lcd_RSPIN,HIGH_PIN); // rs = 0 (command -> 0 char -> 1)
	DIO_SetPinValue(lcd_ControlPORT,lcd_RWPIN,LOW); //rw=0
	DIO_SetPortValue(lcd_DataPORT,u8_Data_Copy);
	DIO_SetPinValue(lcd_ControlPORT,lcd_EPIN,HIGH_PIN);// e=1
	_delay_us(5);
	DIO_SetPinValue(lcd_ControlPORT,lcd_EPIN,LOW);// e=0
	_delay_us(10);
}

void LCD_Set_Col_Row(u8 Column, u8 Row)  //Set DDRAM Address
{
	LCD_Write_Command(Column+127 + ((Row-1) * 0x40));
						//column	//Rows
}

void LCD_Write_String(u8 *String)
{
	u8 size=0, index=0;
	while(*(String+index++) != '\0') size++;
	u8 iteration;
	for(iteration = 0; iteration<size; iteration++)
	{
		LCD_Write_Char(String[iteration]);
		_delay_us(2);
	}
}
const u8  ExtraChar[9][64]=
{
		{ //WORD 0 is *
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, //Char0
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, //Char1
		0x00, 0x00, 0x00, 0x03, 0x04, 0x12, 0x11, 0x0E, //Char2
		0x00, 0x00, 0x00, 0x07, 0x15, 0x0F, 0x00, 0x00, //Char3
		0x10, 0x10, 0x10, 0x11, 0x11, 0x11, 0x02, 0x0C, //Char4
		0x00, 0x00, 0x00, 0x0C, 0x02, 0x1F, 0x00, 0x00, //Char5
		0x00, 0x00, 0x06, 0x00, 0x09, 0x0F, 0x00, 0x00, //Char6
		0x03, 0x07, 0x10, 0x02, 0x0A, 0x1A, 0x00, 0x00  //Char7
		},
		{ //WORD 1 is 1 filled Space
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F  //Char0
		},
		{ //WORD 2 is 2 filled Spaces
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char0
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F  //Char0
		},
		{ //WORD 3 is 3 filled Spaces
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char0
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char1
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F  //Char2
		},
		{ //WORD 4 is 4 filled Spaces
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char0
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char1
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char2
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F  //Char3
		},
		{ //WORD 5 is 5 filled Spaces
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char0
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char1
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char2
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char3
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F  //Char4
		},
		{ //WORD 6 is 6 filled Spaces
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char0
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char1
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char2
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char3
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char4
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F  //Char5
		},
		{ //WORD 7 is 7 filled Spaces
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char0
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char1
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char2
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char3
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char4
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char5
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F  //Char6
		},
		{ //WORD 8 is 8 filled Spaces
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char0
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char1
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char2
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char3
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char4
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char5
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char6
		0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, 0x1F, //Char7
		}
};

void LCD_Write_Extra_Char(u8 Word,u8 Col,u8 Row)
{
	LCD_Write_Command(0x40);  //0x40 = 64
	for(u8 i=0 ; i<0x40 ; i++)  LCD_Write_Char(ExtraChar[Word][i]); //writing the extra char on the cg ram

	LCD_Write_Command(0x80);
	LCD_Set_Col_Row(Col,Row);
	for(u8 i=0 ; i<0x08 ; i++) LCD_Write_Char(i); //displaying after accessing ddram
}
